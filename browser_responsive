import sys
from selenium import webdriver
from selenium.webdriver.chrome.service import Service as ChromeService
from selenium.webdriver.firefox.service import Service as FirefoxService
from selenium.common.exceptions import WebDriverException, NoSuchElementException

# ===== 설정 부분 =====
TARGET_URL = "https://www.google.com" 

# 테스트할 해상도 정의 (폭, 높이)
RESOLUTIONS = {
    "PC": (1920, 1080),
    "Tablet": (768, 1024),
    "Mobile": (360, 640)
}

def get_webdriver(browser_name):
    try:
        if browser_name == "chrome":
            service = ChromeService()
            driver = webdriver.Chrome(service=service)
        elif browser_name == "firefox":
            service = FirefoxService()
            driver = webdriver.Firefox(service=service)
        else:
            print(f"오류: 지원하지 않는 브라우저입니다: {browser_name}", file=sys.stderr)
            return None
        return driver
    except WebDriverException as e:
        print(f"웹 드라이버 초기화 실패 ({browser_name}): {e}", file=sys.stderr)
        return None

def check_browser_compatibility():
    print("\n--- 1. 브라우저 호환성 검사 ---")
    browsers_to_test = ["chrome", "firefox"]
    results = {}
    
    for browser_name in browsers_to_test:
        driver = get_webdriver(browser_name)
        if not driver:
            results[browser_name] = "실행 실패: 웹 드라이버 오류"
            continue
        
        try:
            driver.get(TARGET_URL)
            assert "Google" in driver.title, "페이지 제목이 예상과 다름"
            results[browser_name] = "성공"
        except (WebDriverException, AssertionError) as e:
            results[browser_name] = f"실패: {e}"
        finally:
            driver.quit()
    return results

def check_responsive_design():
    print("\n--- 2. 기기별 해상도 대응 검사 ---")
    driver = get_webdriver("chrome")
    if not driver:
        return {"all_resolutions": "실행 실패: 웹 드라이버 오류"}

    results = {}
    for device, (width, height) in RESOLUTIONS.items():
        try:
            driver.set_window_size(width, height)
            driver.get(TARGET_URL)
            results[device] = "성공"
        except (WebDriverException, NoSuchElementException) as e:
            results[device] = f"실패: {e}"
        finally:
            driver.quit()
    return results

if __name__ == "__main__":
    print("브라우저 및 해상도 호환성 검사 시작...")
    browser_results = check_browser_compatibility()
    print("\n브라우저 호환성 검사 결과:")
    for browser, result in browser_results.items():
        print(f"  - {browser.capitalize()}: {result}")
        
    responsive_results = check_responsive_design()
    print("\n해상도 대응 검사 결과:")
    for device, result in responsive_results.items():
        print(f"  - {device}: {result}")